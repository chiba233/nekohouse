<template>
  <div class="maincard">
    <div class="allInput">
      <h1 class="title">ç™½å¤©</h1>
      <div class="inputDiv">
        <div class="inputContent">
          <a class="inputValue">å¤‡è‰</a>
          <n-input-number clearable :precision="1" class="input" round placeholder="æ•°å­—"
                          v-model:value="morningGiveGrass">
            <template #suffix>
              å…‹
            </template>
          </n-input-number>
        </div>
        <div class="inputContent">
          <a class="inputValue">å–‚æ°´</a>
          <n-input-number clearable :precision="1" class="input" round placeholder="æ•°å­—"
                          v-model:value="morningGiveSaltWater">
            <template #suffix>
              ç›æ°´
            </template>
          </n-input-number>
        </div>
        <div class="inputContent">
          <a class="inputValue">å–‚æ°´</a>
          <n-input-number clearable :precision="1" class="input" round placeholder="æ•°å­—"
                          v-model:value="morningGiveCommonWater">
            <template #suffix>
              æ¸…æ°´
            </template>
          </n-input-number>
        </div>
        <div class="inputContent">
          <a class="inputValue">å‰©äº†</a>
          <n-input-number clearable :precision="1" class="input" round placeholder="æ•°å­—"
                          v-model:value="morningLessGrass">
            <template #suffix>
              å…‹è‰
            </template>
          </n-input-number>
        </div>
        <div class="inputContent">
          <a class="inputValue">å‰©äº†</a>
          <n-input-number clearable :precision="1" class="input" round placeholder="æ•°å­—"
                          v-model:value="morningLessSaltDrink">
            <template #suffix>
              ç›æ°´
            </template>
          </n-input-number>
        </div>
        <div class="inputContent">
          <a class="inputValue">å‰©äº†</a>
          <n-input-number clearable :precision="1" class="input" round placeholder="æ•°å­—"
                          v-model:value="morningLessCommonDrink">
            <template #suffix>
              æ¸…æ°´
            </template>
          </n-input-number>
        </div>
      </div>
      <h1 class="title">æ™šä¸Š</h1>
      <div class="inputDiv">
        <div class="inputContent">
          <a class="inputValue">å¤‡è‰</a>
          <n-input-number clearable :precision="1" class="input" round placeholder="æ•°å­—"
                          v-model:value="yesterdayGiveGrass">
            <template #suffix>
              å…‹
            </template>
          </n-input-number>
        </div>
        <div class="inputContent">
          <a class="inputValue">å–‚æ°´</a>
          <n-input-number clearable :precision="1" class="input" round placeholder="æ•°å­—"
                          v-model:value="yesterdayGiveSaltDrink">
            <template #suffix>
              ç›æ°´
            </template>
          </n-input-number>
        </div>
        <div class="inputContent">
          <a class="inputValue">å–‚æ°´</a>
          <n-input-number clearable :precision="1" class="input" round placeholder="æ•°å­—"
                          v-model:value="yesterdayGiveCommonDrink">
            <template #suffix>
              æ¸…æ°´
            </template>
          </n-input-number>
        </div>
        <div class="inputContent">
          <a class="inputValue">å‰©ä¸‹</a>
          <n-input-number clearable :precision="1" class="input" round placeholder="æ•°å­—"
                          v-model:value="yesterdayLessGrass">
            <template #suffix>
              å…‹è‰
            </template>
          </n-input-number>
        </div>
        <div class="inputContent">
          <a class="inputValue">å‰©ä¸‹</a>
          <n-input-number clearable :precision="1" class="input" round placeholder="æ•°å­—"
                          v-model:value="yesterdayLessSaltDrink">
            <template #suffix>
              ç›æ°´
            </template>
          </n-input-number>
        </div>
        <div class="inputContent">
          <a class="inputValue">å‰©ä¸‹</a>
          <n-input-number clearable :precision="1" class="input" round placeholder="æ•°å­—"
                          v-model:value="yesterdayLessCommonDrink">
            <template #suffix>
              æ¸…æ°´
            </template>
          </n-input-number>
        </div>
      </div>
      <h1 class="title">æ‚é¡¹</h1>
      <div class="inputDiv">
        <div class="inputDiv">
          <div class="inputContent">
            <a class="inputValue">ååˆ</a>
            <n-input-number clearable class="input" round placeholder="æ•°å­—"
                            v-model:value="ruminationCount">
              <template #suffix>
                æ¬¡
              </template>
            </n-input-number>
          </div>
          <div class="inputContent">
            <a class="inputValue">ååˆæ¬¡æ•°è¦æ±‚</a>
            <n-input-number class="input" round placeholder="æ•°å­—" v-model:value="ruminationNeed">
              <template #suffix>
                æ¬¡
              </template>
            </n-input-number>
          </div>
          <div class="inputContent">
            <a class="inputValue">é¥²æ–™</a>
            <n-input-number class="input" round placeholder="æ•°å­—" :precision="1" v-model:value="feedEaten">
              <template #suffix>
                å…‹
              </template>
            </n-input-number>
          </div>
        </div>
      </div>
    </div>

    <div class="output">
      <div class="outputButtons">
        <n-button type="primary" class="outputButton" @click="clickOutput">
          è¾“å‡º
        </n-button>
        <n-button type="primary" class="outputButton" @click="cleanAll">
          æ¸…ç©º
        </n-button>
      </div>
      <div class="outputWindow">
        <n-alert type="info" v-if="clipboardStatus===false" class="tips">
          å¯ä»¥å•æœºè¾“å‡ºæ¡†å¤åˆ¶æ–‡æœ¬å“¦
        </n-alert>
        <n-alert type="info" v-if="errorStatus" class="tips">
          {{ dataError }}
        </n-alert>
        <n-alert type="info" v-if="clipboardStatus===true" class="tips">
          {{ clipboardInfo }}
        </n-alert>
        <n-input
            type="textarea"
            class="outputInput"
            placeholder="è¾“å‡º"
            @focus="clipboardUse"
            v-model:value="output">
        </n-input>
        <a class="copyright">å˜¤å˜¤æ€ªåˆ¶ä½œ</a>
      </div>
    </div>
  </div>
</template>
<script setup lang="ts">
import {ref} from "vue";
import {NInputNumber, NButton, NInput, NAlert} from "naive-ui"
import moment from "moment/moment";
import {
  ruminationNeed,
  ruminationCount,
  yesterdayGiveGrass,
  morningLessGrass,
  morningGiveGrass,
  yesterdayGiveSaltDrink,
  yesterdayLessGrass,
  morningLessSaltDrink,
  morningLessCommonDrink,
  morningGiveCommonWater,
  morningGiveSaltWater,
  yesterdayLessSaltDrink, yesterdayLessCommonDrink, yesterdayGiveCommonDrink,
} from "@/components/ts/useStorage"
import 'moment/dist/locale/en-au.js';
import 'moment/dist/locale/zh-cn.js';

moment.locale("zh")


const clipboardInfo = ref()
const time = ref<string>()
const output = ref<string>("")
const morningEatCount = ref<number>()
const yesterdayEatCount = ref<number>()
const morningDrinkCount = ref<number>()
const yesterdayDrinkCount = ref<number>()
const allEatCount = ref<number>()
const feedEaten = ref<number>(0)
const allDrinkCount = ref<number>()
const morningGiveWater = ref<number>()
const morningLessDrink = ref<number>()
const yesterdayGiveWater = ref<number>()
const yesterdayLessWater = ref<number>()
const clipboardStatus = ref<boolean>(false)
const dataError = ref<string>("")
const errorStatus = ref<boolean>(false)

function clipboardUse() {
  navigator.clipboard.writeText(output.value)
      .then(() => {
        clipboardStatus.value = true
        clipboardInfo.value = "å¤åˆ¶æˆåŠŸ"
      })
      .catch((error) => {
        clipboardStatus.value = true
        clipboardInfo.value = "å¤åˆ¶åˆ°å‰ªè´´æ¿æ—¶å‡ºé”™" + error
      });
}

function cleanAll() {
  ruminationCount.value = 0,
      yesterdayGiveGrass.value = 0,
      morningLessGrass.value = 0,
      morningGiveGrass.value = 0,
      yesterdayGiveSaltDrink.value = 0,
      yesterdayLessGrass.value = 0,
      morningLessSaltDrink.value = 0,
      morningLessCommonDrink.value = 0,
      morningGiveCommonWater.value = 0,
      morningGiveSaltWater.value = 0,
      yesterdayLessSaltDrink.value = 0,
      yesterdayLessCommonDrink.value = 0,
      yesterdayGiveCommonDrink.value = 0
}

function clickOutput() {
  morningGiveWater.value = morningGiveSaltWater.value + morningGiveCommonWater.value
  morningLessDrink.value = morningLessCommonDrink.value + morningLessSaltDrink.value
  yesterdayLessWater.value = yesterdayLessSaltDrink.value + yesterdayLessCommonDrink.value
  yesterdayGiveWater.value = yesterdayGiveCommonDrink.value + yesterdayGiveSaltDrink.value
  //ä¸Šé¢è®¡ç®—çš„æ€»æ°´é‡
  morningEatCount.value = morningGiveGrass.value - morningLessGrass.value
  morningDrinkCount.value = morningGiveWater.value - morningLessDrink.value
  yesterdayEatCount.value = yesterdayGiveGrass.value - yesterdayLessGrass.value
  yesterdayDrinkCount.value = yesterdayGiveWater.value - yesterdayLessWater.value
  allEatCount.value = morningEatCount.value + yesterdayEatCount.value
  allDrinkCount.value = morningDrinkCount.value + yesterdayDrinkCount.value
  if (feedEaten.value <= 0) {
    dataError.value = "ä¸ºä»€ä¹ˆæ²¡å–‚é¥²æ–™"
  }
  if (morningEatCount.value < 0) {
    dataError.value = "æ•°æ®é”™è¯¯ï¼Œè¯·æ£€æŸ¥åå¡«å†™"
    errorStatus.value = true
  }
  if (morningDrinkCount.value < 0) {
    dataError.value = "æ•°æ®é”™è¯¯ï¼Œè¯·æ£€æŸ¥åå¡«å†™"
    errorStatus.value = true

  }
  if (yesterdayDrinkCount.value < 0) {
    dataError.value = "æ•°æ®é”™è¯¯ï¼Œè¯·æ£€æŸ¥åå¡«å†™"
    errorStatus.value = true

  }
  if (allEatCount.value < 0) {
    dataError.value = "æ•°æ®é”™è¯¯ï¼Œè¯·æ£€æŸ¥åå¡«å†™"
    errorStatus.value = true

  }
  if (allDrinkCount.value < 0) {
    dataError.value = "æ•°æ®é”™è¯¯ï¼Œè¯·æ£€æŸ¥åå¡«å†™"
    errorStatus.value = true
  }
  if (yesterdayEatCount.value < 0) {
    dataError.value = "æ•°æ®é”™è¯¯ï¼Œè¯·æ£€æŸ¥åå¡«å†™"
    errorStatus.value = true
  }


  output.value = "ğŸŒŸç¾Šé©¼" + time.value + "ç»“æ±‡æŠ¥" + "\n" + "1.ç™½å¤©å¤‡è‰" + morningGiveGrass.value + "å…‹ï¼Œå‰©ä½™" + morningLessGrass.value + "å…‹ï¼Œåƒäº†" +
      morningEatCount.value + "å…‹\n2.æ˜¨æ™šå¤‡è‰" + yesterdayGiveGrass.value + "å…‹ï¼Œå‰©ä½™" + yesterdayLessGrass.value + "å…‹ï¼Œåƒäº†" + yesterdayEatCount.value +
      "å…‹\n3.ç™½å¤©å–‚æ°´" + morningGiveWater.value + "å…‹ï¼Œå‰©ä½™" + morningLessDrink.value + "å…‹\n" +
      "4.æ˜¨æ™šå–‚æ°´" + yesterdayGiveWater.value + "å…‹ï¼Œå‰©ä½™" + yesterdayLessWater.value + "å…‹\n" +
      "5.æ˜¨æ™šå–æ°´" + yesterdayDrinkCount.value + "å…‹ï¼Œç™½å¤©å–æ°´" + morningDrinkCount.value + "å…‹\n" +
      "6.ååˆæ¬¡æ•°è¦æ±‚" + ruminationNeed.value + "ï¼Œååˆ" + ruminationCount.value + "æ¬¡\n" +
      "ğŸŒŸæ€»ç»“ï¼š\n1.åƒè‰æ€»é‡ï¼š" + allEatCount.value + "å…‹\n" +
      "2.é¥²æ–™æ€»é‡ï¼š" + feedEaten.value + "å…‹\n" +
      "3.å–æ°´æ€»é‡ï¼š" + allDrinkCount.value + "å…‹\n" +
      "4.ååˆæ¬¡æ•°ï¼š" + ruminationCount.value + "æ¬¡"
}

time.value = moment().format("MMæœˆDDæ—¥");
console.log(time)
</script>

<style lang="scss">
.outputButtons {
  padding: 1em;
  justify-content: center;
  display: flex;

  .outputButton {
    margin-right: 0.5em;
    margin-left: 0.5em;
  }
}

.title {
  display: flex;
  justify-content: center;
  font-size: 1.2em;
}

.outputWindow {
  padding-left: 0.5em;
  padding-right: 0.5em;
  display: flex;
  justify-content: center;
  flex-direction: column;
  text-align: center;

  .outputInput {
    height: 19em;
    margin-bottom: 1em;
  }

  .tips {
    margin-bottom: 0.5em;
  }

}

.inputDiv {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;

  .inputContent {
    padding-top: 0.5em;
    padding-right: 0.5em;

    .inputValue {
      padding-left: 1em;
      padding-right: 1em;
    }

    .input {
      width: 13em;
    }
  }

}

.copyright {
  margin-bottom: 0.5em;
}


</style>